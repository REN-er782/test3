
import streamlit as st

st.set_page_config(page_title="扶養控除 判定フロー", layout="wide")

st.title("🧾 扶養控除 判定フロー（配偶者・親族含む完全版）")

st.markdown("""---

### 【配偶者に関する判定】""")

with st.expander("STEP 1：配偶者か？"):
    is_spouse = st.radio("対象者は配偶者ですか？", ["はい", "いいえ"])
    if is_spouse == "いいえ":
        st.warning("▶ 配偶者控除の対象外（親族の判定へ進んでください）")

if is_spouse == "はい":
    st.subheader("STEP 2：本人年収は1,000万円以上？")
    income_high = st.radio("本人の年収は？", ["1,000万円未満", "1,000万円以上"])

    st.subheader("STEP 3 or 4：配偶者の収入")
    income_range = st.selectbox("配偶者の年収（おおよそ）", [
        "年収：123万円以下",
        "年収：123万円超〜130万円未満",
        "年収：130万円超〜160万円未満",
        "年収：160万円超〜201万円未満",
        "年収：201万円超"
    ])

    if income_high == "1,000万円以上":
        st.info("")
        result_map = {
            "年収：123万円以下":  ("❌ 控除対象外", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：123万円超〜130万円未満": ("❌ 控除対象外", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：130万円超〜160万円未満": ("❌ 控除対象外", "❌ 被扶養者対象外", "✅ 家族手当支給"),
            "年収：160万円超〜201万円未満": ("❌ 控除対象外", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
            "年収：201万円超":  ("❌ 控除対象外", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
        }
    else:
        result_map = {
            "年収：123万円以下":  ("✅ 配偶者控除対象", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：123万円超〜130万円未満": ("✅ 配偶者特別控除対象", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：130万円超〜160万円未満": ("✅ 配偶者特別控除対象", "❌ 被扶養者対象外", "✅ 家族手当支給"),
            "年収：160万円超〜201万円未満": ("✅ 配偶者特別控除対象（段階的）", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
            "年収：201万円超":  ("✅ 配偶者特別控除対象（段階的）", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
        }

    if income_range in result_map:
        st.success(f"""
**判定結果：**

- 所得控除：{result_map[income_range][0]}
- 健康保険：{result_map[income_range][1]}
- 家族手当：{result_map[income_range][2]}
        """)

# --- 親族・子どもパート ---
st.markdown("""---

### 【親族・子どもに関する判定】""")

st.subheader("STEP 1：対象者の年齢")
age_group = st.selectbox("対象者の年齢層は？", [
    "16歳以下",
    "19〜22歳（特定扶養親族）",
    "その他（一般扶養親族）"
])

if age_group == "16歳以下":
    st.info("""16歳以下は以下のとおり：  
- ❌ 所得税控除対象外（※住民税は控除対象 ✅）  
- ✅ 被扶養者対象  
- ✅ 家族手当支給（※社内規定による）""")
else:
    income_child = st.selectbox("対象者の年間収入(目安)", [
        "年収：123万円以下",
        "年収：123万円超〜130万円未満",
        "年収：130万円超〜160万円未満",
        "年収：160万円超〜188万円未満",
        "年収：188万円超"
    ])

    if age_group == "19〜22歳（特定扶養親族）":
        result_map = {
            "年収：123万円以下": ("✅ 控除対象", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：123万円超〜130万円未満": ("✅ 控除対象", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：130万円超〜160万円未満": ("✅ 控除対象", "❌ 被扶養者対象外", "✅ 家族手当支給"),
            "年収：160万円超〜188万円未満": ("✅ 控除対象（段階的）", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
            "年収：188万円超": ("❌ 控除対象外", "❌ 被扶養者対象外", "❌ 家族手当不支給")
        }
    else:
        result_map = {
            "年収：123万円以下": ("✅ 控除対象", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：123万円超〜130万円未満": ("❌ 控除対象外", "✅ 被扶養者対象", "✅ 家族手当支給"),
            "年収：130万円超〜160万円未満": ("❌ 控除対象外", "❌ 被扶養者対象外", "✅ 家族手当支給"),
            "年収：160万円超〜188万円未満": ("❌ 控除対象外", "❌ 被扶養者対象外", "❌ 家族手当不支給"),
            "年収：188万円超": ("❌ 控除対象外", "❌ 被扶養者対象外", "❌ 家族手当不支給")
        }

    if income_child in result_map:
        st.success(f"""
**判定結果：**

- 所得控除：{result_map[income_child][0]}
- 健康保険：{result_map[income_child][1]}
- 家族手当：{result_map[income_child][2]}
        """)

